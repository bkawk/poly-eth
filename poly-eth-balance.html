<link rel="import" href="../polymer/polymer-element.html">
<!--<link rel="import" href="../polymer/lib/elements/dom-if.html">-->
<!--<link rel="import" href="../polymer/lib/elements/dom-repeat.html">-->

<link rel="import" href="poly-eth.html">

<!--
`poly-eth-passphrase`

@demo demo/join.html
-->

<dom-module id="poly-eth-balance">
<template>
    <style>
    :host {
        display: block;
    }
    .container{
        text-align: center;
    }
    </style>
    <poly-eth id="eth"></poly-eth>

</template>

<script>
    class PolyEthBalance extends Polymer.Element {
    
    static get is() { 
        return 'poly-eth-balance'; 
    }

    static get properties() {
        return {
            address:{
                type: String,
                observer: '_address'
            },
            currencyCode:{
                type: String,
                observer: '_address'
            },
            ether:{
                type: Number,
                notify: true
            },
            fiat:{
                type: Number,
                notify: true
            },
            interval:{
                type: Number,
                value: 3000
            }
        };
    }

    connectedCallback(){
        super.connectedCallback();
        this.ether = JSON.parse(localStorage.getItem("balance")).ether
        this.fiat = JSON.parse(localStorage.getItem("balance")).fiat
        setInterval(()=>{ 
            if(this.address && this.currencyCode){
                this._address()
            }
        }, this.interval);
    }

    _address(){
        if(this.address != undefined && this.currencyCode != undefined){
            this.$.eth.addressBalance(this.address, this.currencyCode)
            .then((data) => {
                this.ether = data.ether;
                this.fiat = data.currencyValue;
                localStorage.setItem("balance", JSON.stringify({"ether": this.ether, "fiat": this.fiat, "currencyCode": this.currencyCode}));
            })
            .catch((err) => {
                reject(Error(err))
            })
        }
    }

    } window.customElements.define(PolyEthBalance.is, PolyEthBalance);
</script>
</dom-module>
